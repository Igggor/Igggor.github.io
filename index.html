<html ng-app="custom-webapp-ui" lang="en">
  <head>
    <!-- Load the Telegram Library -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!--Load the AngularJS Library-->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
  </head>
  <body ng-controller="CustomUIController">
    <form id="form">
        <label for="full_name">ФИО заказчика:</label>
        <input type="text" id="full_name" name="full_name" required>

        <label for="executor_name">Имя выполнившего работу:</label>
        <input type="text" id="executor_name" name="executor_name" required>

        <label for="address">Адрес выполнения:</label>
        <input type="text" id="address" name="address" required>

        <label for="date">Дата выполнения:</label>
        <input type="date" id="date" name="date" required>

        <label for="media">Медиа файлы:</label>
        <input type="file" id="media" name="media" multiple accept="image/*,video/*" required>

        <button type="button" onclick="sendData()">Отправить</button>
    </form>

    <script>
        function sendData() {
            const full_name = document.getElementById('full_name').value;
            const executor_name = document.getElementById('executor_name').value;
            const address = document.getElementById('address').value;
            const date = document.getElementById('date').value;
            const media_files = document.getElementById('media').files;

            // Convert media files to base64
            const promises = [];
            for (let i = 0; i < media_files.length; i++) {
                promises.push(readFileAsDataURL(media_files[i]));
            }

            Promise.all(promises).then(base64Files => {
                const data = {
                    full_name: full_name,
                    executor_name: executor_name,
                    address: address,
                    date: date,
                    media: base64Files
                };
                Telegram.WebApp.sendData(JSON.stringify(data));
            }).catch(error => {
                console.error('Error converting files to base64:', error);
            });
        }

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }
    </script>
  </body>
    <script></script>
</html>
